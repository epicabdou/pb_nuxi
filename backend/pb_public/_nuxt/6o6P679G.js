import{_ as z}from"./CYKZh6Wd.js";import{u as Y,e as J,r as v,f as $,g as S,h as Q,i as R,j as H,c as r,a as e,k as f,F as j,l as F,t as i,m as P,n as x,v as k,b as K,w as X,p as N,o,d as Z}from"./DzVV_QxS.js";const ee={class:"responsive-container section-padding"},se={key:0,class:"flex justify-center items-center py-16"},te={key:1},ae={class:"mb-8 border-b border-background-300 dark:border-background-700"},re={class:"flex flex-wrap"},oe=["onClick"],le={key:0,class:"grid md:grid-cols-[300px_1fr] gap-8"},ne={class:"card flex flex-col items-center"},ie={class:"relative w-48 h-48 mb-4"},de=["src"],ue={key:1,class:"w-full h-full bg-background-300 dark:bg-background-700 rounded-full flex items-center justify-center"},ce={class:"text-5xl font-bold text-background-500"},pe={class:"text-xl font-bold"},me={class:"text-background-600 dark:text-background-400"},fe={class:"card"},be={class:"mb-4"},ve=["disabled"],ge={class:"mb-4"},we={class:"flex justify-end mt-6"},ye={key:1,class:"flex space-x-3"},he=["disabled"],xe={key:1,class:"max-w-xl mx-auto"},ke={class:"card"},_e={class:"mb-4"},Pe={class:"mb-4"},Ce={class:"mb-4"},Ee={key:0,class:"input-error-text"},Ue={class:"flex justify-end mt-6"},$e=["disabled"],Se={key:2,class:"space-y-6"},je={key:0,class:"card text-center py-12"},Fe={key:1},Ne={class:"flex justify-between items-center border-b border-background-300 dark:border-background-700 pb-4 mb-4"},Ie={class:"font-bold"},Ve={class:"text-sm text-background-600 dark:text-background-400"},De={key:0,class:"space-y-4"},Te={class:"w-16 h-16 bg-background-200 dark:bg-background-800 rounded overflow-hidden mr-4"},Le=["src"],Ae={class:"flex-1"},qe={class:"font-medium"},Me={class:"text-sm text-background-600 dark:text-background-400"},Oe={class:"text-right"},Be={class:"font-medium"},Ge={class:"border-t border-background-300 dark:border-background-700 mt-4 pt-4"},We={class:"flex justify-between font-bold"},ze={class:"fixed bottom-4 right-4 z-50"},Ye={class:"flex items-center"},Je={class:"font-medium"},Ke={__name:"index",setup(Qe){const{$pb:c}=Y(),g=J(),_=R(),C=v(!0),p=v(!1),b=v(!1),l=v({}),w=$({name:""}),n=$({currentPassword:"",newPassword:"",confirmPassword:""}),E=v([]),u=$({show:!1,message:"",type:"success",timeout:null}),y=v("profile"),D=[{id:"profile",label:"Profile"},{id:"password",label:"Password"},{id:"orders",label:"Orders"}],I=S(()=>l.value&&l.value.avatar?`${c.baseUrl}/api/files/${l.value.collectionId}/${l.value.id}/${l.value.avatar}`:null),T=S(()=>l.value.name?l.value.name.split(" ").map(a=>a.charAt(0)).join("").toUpperCase().substring(0,2):"?"),U=S(()=>n.newPassword&&n.confirmPassword&&n.newPassword!==n.confirmPassword);Q(async()=>{try{if(!g.isAuthenticated)return _.push("/login");await L(),await A(),C.value=!1}catch(a){m("Error loading profile data","error"),console.error("Error loading profile:",a),C.value=!1}}),H(()=>g.isAuthenticated,a=>{a||_.push("/login")});async function L(){try{if(!c.authStore.isValid)return _.push("/login");l.value=c.authStore.model,w.name=l.value.name||""}catch(a){throw console.error("Error fetching user data:",a),a}}async function A(){try{const a=await c.collection("orders").getList(1,50,{filter:`user="${l.value.id}"`,sort:"-created",expand:"user"}),s=await Promise.all(a.items.map(async h=>{const t=await c.collection("orderItems").getList(1,100,{filter:`order="${h.id}"`,expand:"product"});return{...h,items:t.items}}));E.value=s}catch(a){console.error("Error fetching orders:",a),m("Failed to load order history","error")}}async function q(){if(b.value){p.value=!0;try{const a={name:w.name},s=await c.collection("users").update(l.value.id,a);l.value=s,g.setUser(s),b.value=!1,m("Profile updated successfully","success")}catch(a){console.error("Error updating profile:",a),m("Failed to update profile","error")}finally{p.value=!1}}}async function M(){if(!U.value){p.value=!0;try{await c.collection("users").authWithPassword(l.value.email,n.currentPassword),await c.collection("users").update(l.value.id,{password:n.newPassword,passwordConfirm:n.confirmPassword}),n.currentPassword="",n.newPassword="",n.confirmPassword="",m("Password updated successfully","success")}catch(a){console.error("Error updating password:",a),a.status===400?m("Current password is incorrect","error"):m("Failed to update password","error")}finally{p.value=!1}}}async function O(a){const s=a.target.files[0];if(!s)return;if(!["image/jpeg","image/png","image/gif","image/webp"].includes(s.type)){m("Please upload a valid image (JPEG, PNG, GIF, or WebP)","error");return}p.value=!0;try{const t=new FormData;t.append("avatar",s);const d=await c.collection("users").update(l.value.id,t);l.value=d,g.setUser(d),m("Profile picture updated","success")}catch(t){console.error("Error uploading avatar:",t),m("Failed to upload profile picture","error")}finally{p.value=!1,a.target.value=null}}function B(){b.value=!1,w.name=l.value.name||""}async function G(){try{await g.logout(),_.push("/login")}catch(a){console.error("Error during logout:",a)}}function W(a){return a?`${c.baseUrl}/api/files/products/${a.recordId}/${a.name}`:""}function m(a,s="success"){u.timeout&&clearTimeout(u.timeout),u.message=a,u.type=s,u.show=!0,u.timeout=setTimeout(()=>{u.show=!1},5e3)}return(a,s)=>{const h=z;return o(),r("main",ee,[C.value?(o(),r("div",se,s[8]||(s[8]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"},null,-1)]))):(o(),r("div",te,[s[23]||(s[23]=e("h1",{class:"heading-2 mb-8"},"My Profile",-1)),e("div",ae,[e("div",re,[(o(),r(j,null,F(D,t=>e("button",{key:t.id,onClick:d=>y.value=t.id,class:N(["px-4 py-3 font-medium transition-colors duration-200 border-b-2 -mb-px",y.value===t.id?"text-primary-600 border-primary-500":"text-background-600 dark:text-background-400 border-transparent hover:text-background-900 dark:hover:text-white"])},i(t.label),11,oe)),64))])]),y.value==="profile"?(o(),r("div",le,[e("div",ne,[e("div",ie,[I.value?(o(),r("img",{key:0,src:I.value,alt:"Profile avatar",class:"w-full h-full object-cover rounded-full"},null,8,de)):(o(),r("div",ue,[e("span",ce,i(T.value),1)])),e("div",{onClick:s[0]||(s[0]=t=>a.$refs.avatarInput.click()),class:"absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-40 rounded-full flex items-center justify-center transition-all duration-200 cursor-pointer"},s[9]||(s[9]=[e("span",{class:"text-white opacity-0 hover:opacity-100 font-medium"},"Change Photo",-1)])),e("input",{ref:"avatarInput",type:"file",class:"hidden",accept:"image/*",onChange:O},null,544)]),e("h2",pe,i(l.value.name||"No name set"),1),e("p",me,i(l.value.email),1),b.value?(o(),r("button",{key:0,onClick:G,class:"btn-ghost mt-6 text-error-500"}," Logout ")):f("",!0)]),e("div",fe,[s[13]||(s[13]=e("h2",{class:"text-xl font-bold mb-6"},"Personal Information",-1)),e("form",{onSubmit:P(q,["prevent"])},[e("div",be,[s[10]||(s[10]=e("label",{class:"input-label"},"Name",-1)),x(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>w.name=t),type:"text",class:"input-primary",disabled:!b.value,placeholder:"Enter your name"},null,8,ve),[[k,w.name]])]),e("div",ge,[s[11]||(s[11]=e("label",{class:"input-label"},"Email",-1)),x(e("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>l.value.email=t),type:"email",class:"input-primary",disabled:"",placeholder:"Email address"},null,512),[[k,l.value.email]]),s[12]||(s[12]=e("p",{class:"input-help"},"Email cannot be changed",-1))]),e("div",we,[b.value?(o(),r("div",ye,[e("button",{onClick:P(B,["prevent"]),type:"button",class:"btn-secondary"}," Cancel "),e("button",{type:"submit",class:"btn-primary",disabled:p.value},i(p.value?"Saving...":"Save Changes"),9,he)])):(o(),r("button",{key:0,onClick:s[3]||(s[3]=P(t=>b.value=!0,["prevent"])),type:"button",class:"btn-primary"}," Edit Profile "))])],32)])])):f("",!0),y.value==="password"?(o(),r("div",xe,[e("div",ke,[s[18]||(s[18]=e("h2",{class:"text-xl font-bold mb-6"},"Change Password",-1)),e("form",{onSubmit:P(M,["prevent"])},[e("div",_e,[s[14]||(s[14]=e("label",{class:"input-label"},"Current Password",-1)),x(e("input",{"onUpdate:modelValue":s[4]||(s[4]=t=>n.currentPassword=t),type:"password",class:"input-primary",placeholder:"Enter your current password",required:""},null,512),[[k,n.currentPassword]])]),e("div",Pe,[s[15]||(s[15]=e("label",{class:"input-label"},"New Password",-1)),x(e("input",{"onUpdate:modelValue":s[5]||(s[5]=t=>n.newPassword=t),type:"password",class:"input-primary",placeholder:"Enter new password",required:"",minlength:"8"},null,512),[[k,n.newPassword]]),s[16]||(s[16]=e("p",{class:"input-help"},"Password must be at least 8 characters",-1))]),e("div",Ce,[s[17]||(s[17]=e("label",{class:"input-label"},"Confirm New Password",-1)),x(e("input",{"onUpdate:modelValue":s[6]||(s[6]=t=>n.confirmPassword=t),type:"password",class:"input-primary",placeholder:"Confirm new password",required:""},null,512),[[k,n.confirmPassword]]),U.value?(o(),r("p",Ee,"Passwords do not match")):f("",!0)]),e("div",Ue,[e("button",{type:"submit",class:"btn-primary",disabled:p.value||U.value||!n.newPassword},i(p.value?"Updating...":"Update Password"),9,$e)])],32)])])):f("",!0),y.value==="orders"?(o(),r("div",Se,[E.value.length===0?(o(),r("div",je,[s[20]||(s[20]=e("h3",{class:"text-xl font-medium mb-2"},"No Orders Yet",-1)),s[21]||(s[21]=e("p",{class:"text-background-600 dark:text-background-400"},"You haven't placed any orders yet.",-1)),K(h,{to:"/products",class:"btn-primary mt-6 inline-flex"},{default:X(()=>s[19]||(s[19]=[Z("Start Shopping")])),_:1})])):(o(),r("div",Fe,[(o(!0),r(j,null,F(E.value,t=>(o(),r("div",{key:t.id,class:"card mb-6"},[e("div",Ne,[e("div",null,[e("h3",Ie,"Order #"+i(t.id.substring(0,8)),1),e("p",Ve,i(new Date(t.created).toLocaleDateString()),1)]),e("div",null,[e("span",{class:N(["badge",{"badge-primary":t.status==="delivered","badge-success":t.status==="shipped","badge-error":t.status==="cancelled","badge-secondary":t.status==="pending"||t.status==="paid"}])},i(t.status.charAt(0).toUpperCase()+t.status.slice(1)),3)])]),t.items&&t.items.length?(o(),r("div",De,[(o(!0),r(j,null,F(t.items,d=>{var V;return o(),r("div",{key:d.id,class:"flex items-center py-2"},[e("div",Te,[d.product&&d.product.image?(o(),r("img",{key:0,src:W(d.product.image),alt:"Product",class:"w-full h-full object-cover"},null,8,Le)):f("",!0)]),e("div",Ae,[e("h4",qe,i(((V=d.product)==null?void 0:V.name)||"Product"),1),e("p",Me," Qty: "+i(d.quantity)+" × $"+i(d.price.toFixed(2)),1)]),e("div",Oe,[e("p",Be,"$"+i((d.quantity*d.price).toFixed(2)),1)])])}),128))])):f("",!0),e("div",Ge,[e("div",We,[s[22]||(s[22]=e("span",null,"Total",-1)),e("span",null,"$"+i(t.totalPrice.toFixed(2)),1)])])]))),128))]))])):f("",!0)])),e("div",ze,[u.show?(o(),r("div",{key:0,class:N(["p-4 rounded-lg shadow-lg max-w-sm transform transition-all",{"bg-success-500 text-white":u.type==="success","bg-error-500 text-white":u.type==="error"}])},[e("div",Ye,[e("span",Je,i(u.message),1),e("button",{onClick:s[7]||(s[7]=t=>u.show=!1),class:"ml-auto"},s[24]||(s[24]=[e("span",{class:"text-xl"},"×",-1)]))])],2)):f("",!0)])])}}};export{Ke as default};
