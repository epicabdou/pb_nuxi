import{a6 as o}from"./DzVV_QxS.js";const c=o("cart",{state:()=>({items:[],isCartOpen:!1}),getters:{cartCount:t=>t.items.reduce((e,r)=>e+r.quantity,0),cartTotal:t=>t.items.reduce((e,r)=>e+r.price*r.quantity,0),hasItems:t=>t.items.length>0,formattedCartTotal:t=>`$${t.items.reduce((r,i)=>r+i.price*i.quantity,0).toFixed(2)}`},actions:{addItem(t){const e=this.items.find(r=>r.id===t.id);e?e.quantity+=t.quantity||1:this.items.push({...t,quantity:t.quantity||1}),this.saveCart()},updateItemQuantity(t,e){const r=this.items.find(i=>i.id===t);if(r){if(r.quantity=e,e<=0){this.removeItem(t);return}this.saveCart()}},incrementItem(t){const e=this.items.find(r=>r.id===t);e&&(e.quantity+=1,this.saveCart())},decrementItem(t){const e=this.items.find(r=>r.id===t);e&&e.quantity>1?(e.quantity-=1,this.saveCart()):e&&e.quantity===1&&this.removeItem(t)},removeItem(t){this.items=this.items.filter(e=>e.id!==t),this.saveCart()},clearCart(){this.items=[],this.saveCart()},toggleCart(){this.isCartOpen=!this.isCartOpen},saveCart(){localStorage.setItem("cart",JSON.stringify(this.items))},loadCart(){{const t=localStorage.getItem("cart");t&&(this.items=JSON.parse(t))}},async createOrder(t,e){if(!this.hasItems)return null;try{const r={user:t.authStore.model.id,totalPrice:this.cartTotal,status:"pending"},i=await t.collection("orders").create(r),a=this.items.map(s=>t.collection("orderItems").create({order:i.id,product:s.id,quantity:s.quantity,price:s.price}));return await Promise.all(a),e&&await t.collection("shippingAddresses").create({order:i.id,user:t.authStore.model.id,...e}),this.clearCart(),i}catch(r){throw console.error("Error creating order:",r),r}}}});export{c as u};
